<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>관리자 페이지</title>
 <!-- jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
<!-- 매장검색 자바스크립트 -->
<script type="text/javascript" src="./resources/js/saleScript.js" ></script>
<!-- 고객검색 자바스크립트 -->
<script type="text/javascript" src="./resources/js/custScript.js" ></script>
<style type="text/css">
@charset "UTF-8";

/* body여백 없애기 */
body{
	margin: 0;
	padding: 0;
}
.star{
	display: table-cell;
	vertical-align: middle;
	font-size: 21px;
	color: #D5D5D5;
	padding: 5px;
}
.starBox{
	border-radius: 5px;
	border: 1px solid;
	margin-left: 5px;
	width: 20px;
	height: 20px;
	display: inline;
	font-size: 23px;
	color: #D5D5D5;
}
.Title{
	font-size: 20px;
}
.Refresh{
	filter: opacity(0.5) drop-shadow(0 0 0 #B8C6CC);
	width: 20px;
	height: 20px;
}
.Wrap {
    margin-left: 190px;
    position: relative;
    padding: 85px 85px 35px 85px;
}
/* 상단검색박스 */
.SearchBox {
    border-radius: 30px;
    padding: 6px 40px 0;
    width: 1100px;
    margin: auto;
    height: 83px;
    background-color: #F6F6F6;
    margin-top: 30px;
}
#Search_but_sale{
	margin-left: 869px;
    margin-top: 1.5px;
    position: absolute;
    left: 376px;
    background-color: #3E76D6;
    border-style: none;
    width: 31px;
    height: 28px;
}
#Search_but_sale:hover{
	cursor: pointer;
}
#Search_but_cust {
	margin-left: -37px;
    position: absolute;
    background-color: #3E76D6;
    border-style: none;
    width: 31px;
    height: 28px;
    margin-top: 2px;
}
#Search_but_cust:hover{
	cursor: pointer;
}
.Text_space{
	margin-right: 50px;
}
.essential{
	color: red;
	font-weight: 700;
}
.Text_box{
	height: 25px;
	width: 130px;
	border: 1px solid #BDBDBD;
	background-color: white;
}
#saleMonth-list{
	height: 28px;
    width: 136px;
}
.Text_date{
	height: 25px;
	width: 90px;
	border: 1px solid #BDBDBD;
	background-color: white;
}
#wrap_s{
	margin-left: 122px;
}
/* 검색버튼 */
#Search_but{
	width: 42px;
	height: 42px;
	float: right;
	background-color: #3E76D6;
	border: none;
	border-radius: 10px;
	cursor: pointer;
}
.total_search{
	filter: brightness(0) invert(1);
	width: 30px;
	height: 21px;
	margin: 2px -4px;
}
.wrap_mg{
    padding: 23px 30px 20px 30px;
}
.radio_check{
	vertical-align: text-top;
	width: 20px;
	height: 20px;
}
.Text_space_s{
	margin-right: 10px;
}
/* 신규버튼 */
.new_registration{
    width: 100px;
    height: 30px;
    float: right;
    margin-right: 78px;
    margin-bottom: 20px;
    border-style: none;
    border-radius: 5px;
}
.new_registration:hover{
	cursor: pointer;
	background-color: #E61200;
	color: white;
}
#date{
	width: 90px;
}
/* 고객기본정보표 */
#sale-table {
	font-size: 14px;
	margin-bottom: 40px;
	margin-top: 10px;
    padding-top: 25px;
    display: block;
    border: 1px solid gray;
    width: 1180px;
    margin-left: 275px;
    height: 410px;
}
/* 구매표 */
#buy-table {
    margin-bottom: 27px;
    margin-top: 2px;
    display: block;
    border: 1px solid gray;
    width: 1180px;
    margin-left: 275px;
    height: 78px;
}
thead {
	display:block;
    width:100%;
}

table thead tr {
	display:table;
    table-layout:fixed;
    width:100%;
}

tbody {
	width: 100%;
	display: block;
    height: 18rem;
}

tbody tr {
    width: 100%;
	display: table;
    table-layout: fixed;
}

tbody th{
	background-color: gray;
}
table thead th{
    background-color: #E61200;
    color: white;
}
th, td {
	border: 1px solid #444444;
	background-color: white;
	
}
.CustNum{
	width: 120px;
}
.CustNum-td{
	width: 120px;
	background-color: white;
}
.CustDetail{
	width: 120px;
}
.CustDetail-td{
	width: 120px;
	background-color: white;
}
.dateDay{
    text-align: center;
	width: 80px;
}
.joinDate{
	text-align: center;
    width: 130px;
}
.SaleInfo{
	width: 110px;
}
.Cust{
	width: 140px;
}
.dateSum{
	position: sticky;
    width: 180px;
    min-width: 180px;
    max-width: 180px;
    right: 0;
}
#saleSum{
	background-color: white;
}
#SumFix{
	text-align: center;
	position: sticky;
	left: 166px;
	background-color: white;
}
.main {
	padding-top:34px;
}
.box {
	width: 600px;
	height: 150px;
	overflow-y: scroll;
}
tr.title {
	margin: -33px 0px 0px -1px;
	width: 600px;
	display: table;
	position: absolute;
	background-color: #5dcafc;
}
th, td {
	padding: 6px;
} 

table{
	font-size: 15px;
}
tbody {
	font-size: 13px;
}
#saleCode{
	background-color: #BDBDBD;
}
#reload{
	background-color: white;
	border: none;
}
/* 매장조회 팝업창 */
#light_shop{
	text-align: center;
	margin: 0 auto; 
	font-size: 14px;
}
.CustCheck_Wrap_shop{
	height: 65px;
    background: #F6F6F6;
    padding: 15px;
}
.white_content_shop{
	display: none;
    position: absolute;
    top: 45%;
    left: 22%;
    width: 750px;
    height: 472px;
    padding: 16px;
    border: 1px solid #BDBDBD;
    background-color: white;
    z-index: 1002;
    overflow: auto;
    border-radius: 1.5rem;
}
.Cust_popup_table{
    border: 1px solid gray;
	height: 250px;
    border-collapse: collapse;
    width: 100%;
    display: block;
    height: 16rem;
}
.Cust_popup_table thead {
    table-layout: fixed;
/*     display: block; */
    width: 100%;
    height: 32px;
}
#searchPopup{
    overflow: auto;
}
#searchPopup {
	width: 100%;
	display: block;
    height: 14rem;
}
.Check_Box{
    width: 60px;
    position: sticky;
    top: 0px;
/*     background-color: #E61200 !important; */
    color: white;
}
.black_overlay{
	display: none;
    position: absolute;
    top: 0%;
    left: -15%;
    width: 115%;
    height: 224%;
    background-color: rgba(0, 0, 0, 0.4);
    z-index: 1001;
    -moz-opacity: 0.8;
    opacity: .80;
    filter: alpha(opacity=80);
}
.popupBut{
    border-style: none;
    border-radius: 6px;
    margin: 10px;
    width: 150px;
    height: 40px;
}
.CustCheck_Info {
    width: 190px;
    height: 34px;
    border: 1px solid #A6A6A6;
}
th, td {
	border: 1px solid #444444;
	background-color: white;
	
}
#dataSumTitle{
	text-align: center;
}
#title{
	margin-left: 278px;
	font-size: 16px;
}
.inputBox{
    border: 1px solid #BDBDBD;
    width: 120px;
    height: 25px;
	margin-left: 2px;
}
.loginInputBox{
	border: 1px solid #BDBDBD;
    width: 100px;
    height: 25px;
}
.phoneinputBox{
	margin: 2px;
    border: 1px solid #BDBDBD;
    width: 50px;
    height: 25px;
}
.custNameWrap{
    width: 273px;
    display: inline-block;
	margin: 10px 50px 10px 50px;
}
.custCauseWrap{
    width: 273px;
    display: inline-block;
    margin: 10px 61px;
}
.custDateWrap{
    width: 273px;
    display: inline-block;
	margin: 10px 50px 10px 60px;
}
.custNameWrapR{
    padding-left: 14px;
	width: 253px;
    display: inline-block;
}
.custShopWrap{
    width: 350px;
    display: inline-block;
    margin-bottom: 20px;
}
.textWrap{
	margin-right: 15px;
}
.custPhoneWrap{
	height: 50px;
    width: 428px;
    display: -webkit-inline-box;
    margin: 10px 50px 0px 50px;
}
.custAddressWrap{
	width: 553px;
    margin: 20px 203px 0px 178px;
    height: 27px;
}
.custEmailWrap {
    width: 405px;
    display: inline-block;
    margin: 10px 25px;
}
.custAddressTextWrap {
    width: 309px;
    display: inline-block;
    margin: 10px 50px;
}
.custStateWrap {
    width: 363px;
    display: inline-block;
    margin: 10px 24px 10px 50px;
}
.firstJoinWrap {
	width: 293px;
    display: inline-block;
    margin: 10px 10px;
}
.joinWrap{
    width: 244px;
    display: inline-block;
	margin: 10px 12px 0px 33px;
}
.stopWrap{
    width: 244px;
    display: inline-block;
	margin: 20px 0px 0 52px;
}
.exWrap{
    width: 244px;
    display: inline-block;
    margin: 10px 60px 0 92px;
}
#custScalY{
    margin-left: 81px;
}
.custScalWrap{
    width: 290px;
    display: inline-block;
    margin: 10px 42px 0 50px;
}
#custStateY{
    margin-left: 52px;
}
#custSexId{
    margin-left: 56px;
}
#custNameId2{
 	margin-left: 57px;
}
#custEmailId{
    margin-left: 48px;
}
#custDateBox{
	margin-left: 32px;
}
#custMarryBox{
    margin-left: 17px;
}
#jobCode{
	margin-left: 26px;
}
#custJoinBox{
	margin-left: 26px;
}
#causeBox{
    margin-left: 52px;
}
#stopBox{
    margin-left: 33px;
}
#cancelBox{
    margin-left: 28px;
}
.buyWrap{
    width: 325px;
    display: inline-block;
    margin: 20px 10px;
}
#close{
	margin-left: 710px;
	margin-bottom: 100px;
}
.popupBut:hover {
	background-color: black;
	color: white;
	cursor: pointer;
}
#phoneBut {
	border-style: none;
	border-radius: 6px;
	width: 41px;
	height: 29px;
}

#phoneBut:hover {
	background-color: black;
	color: white;
	cursor: pointer;
}
</style>
<!-- <link href="resources/CSS/custInfo.css" rel="stylesheet"> -->
<c:import url="../common/navbar.jsp"/>
</head>
<body>
<c:import url="../common/sidebar.jsp"/>
<input type="hidden" id="cc" value="${ changeDtIn.CUST_NO }">
<!-- 핸드폰중복 -->
<input type="hidden" id="mb1">
<input type="hidden" id="mb2">
<input type="hidden" id="mb3">
<!-- 핸드폰 중복END -->

<!-- **원본값**(변경된 내용과 비교하기 위함) -->
<form method="post" id="custChange">
	<input type="hidden" id="CuserId" name="LST_UPD_ID" value="${ loginUser.userId}">
	<input type="hidden" id="CNo" name="CUST_NO" value="${changeDtIn.CUST_NO}">
	<input type="hidden" id="CNm" name="CUST_NM" value="${changeDtIn.CUST_NM}">
	<input type="hidden" id="CDate"><!-- 생년월일 -->
	<input type="hidden" id="CDateOrigin" value="${changeDtIn.BRDY_DT}">
	<input type="hidden" id="CDate1" name="BRDY_DT">
	<input type="hidden" id="CMarryOrigin" value="${changeDtIn.MRRG_DT}">
	<input type="hidden" id="CMarry" name="MRRG_DT">
	<input type="hidden" id="CSexId" name="SEX_CD" value="${changeDtIn.SEX_CD}">
	<input type="hidden" id="CScal" name="SCAL_YN" value="${changeDtIn.SCAL_YN}">
	<input type="hidden" id="Ccause" name="CNCL_CNTS" value="${changeDtIn.CNCL_CNTS}">
	<input type="hidden" id="CPoc" name="POC_CD" value="${changeDtIn.POC_CD}">
	<input type="hidden" id="CssCd" name="CUST_SS_CD" value="${changeDtIn.CUST_SS_CD}">
	<input type="hidden" id="Cemail" name="EMAIL_RCV_YN" value="${changeDtIn.EMAIL_RCV_YN}">
	<input type="hidden" id="Csms" name="SMS_RCV_YN" value="${changeDtIn.SMS_RCV_YN}">
	<input type="hidden" id="CDm" name="DM_RCV_YN" value="${changeDtIn.DM_RCV_YN}">
	<input type="hidden" id="Cadd" name="ADDR" value="${changeDtIn.ADDR}">
	<input type="hidden" id="CaddDt" name="ADDR_DTL" value="${changeDtIn.ADDR_DTL}">
	<input type="hidden" id="CPsmt" name="PSMT_GRC_CD" value="${changeDtIn.PSMT_GRC_CD}">
	<input type="hidden" id="stopDt" name="STP_DT" value="${changeDtIn.STP_DT}">		<!-- 중지일자 -->
	<input type="hidden" id="cancelDt" name="CNCL_DT" value="${changeDtIn.CNCL_DT}">	<!-- 해지일자 -->
	<!-- 통핸드폰번호 -->
	<input type="hidden" id="mb_f" name="MBL_NO" value="${changeDtIn.MBL_NO}">
	<!-- 각각 핸드폰번호 -->
	<input type="hidden" id="mb1" value="${changeDtIn.MBL_NO1}">
	<input type="hidden" id="mb2" value="${changeDtIn.MBL_NO2}">
	<input type="hidden" id="mb3" value="${changeDtIn.MBL_NO3}">
	<!-- 가입매장코드 -->
	<input type="hidden" id="Ccd" name="JN_PRT_CD" value="${changeDtIn.JN_PRT_CD}">
	<input type="hidden" id="CSemail" name="EMAIL" value="${changeDtIn.EMAIL}">
</form>


<form method="post" name="custUpdate" id="custUpdateId">
<!-- 변경확인할 데이터 -->
<input type="hidden" id="aftNo" name="CUST_NO">
<input type="hidden" id="phoneNumble" name="MBL_NO">
<input type="hidden" id="birth" name="BRDY_DT">
<input type="hidden" id="MarryDay" name="MRRG_DT">
<input type="hidden" id="jsDt2"><!-- 가입일자 -->
<input type="hidden" id="stopDt2" name="STP_DT"><!-- 중지일자 -->
<input type="hidden" id="cancelDt2" name="CNCL_DT"><!-- 해지일자 -->
<input type="hidden" id="useridS" name="LST_UPD_ID" value="${ loginUser.userId}">
<input type="hidden" id="emailFull" name="EMAIL">
<input type="hidden" id="result">
<input type="hidden" id="changCheckVal">

<div class="Wrap">
	<div class="starBox">
		<span class="star">★</span>
		
	</div>
	<span class="Title">고객정보조회</span>
<!-- 	새로고침 -->
	<button type="button" id="reload" onClick="window.location.reload()">
		<img class="Refresh" src="resources/cust_in/Refresh.png" style="cursor:pointer;">
	</button>
	<div class="SearchBox">
		<div class="wrap_mg">
			<!-- 고객번호조회 -->
			<span class="Text_space" id="Cust_Num">고객번호</span>
			<input class="Text_box" id="custInput" style="background-color: #BDBDBD;" readonly>
			<!-- 고객번호 검색버튼 -->
			<button type="button" onclick="Search_but_num()" id="Search_but_cust" >
				<img class="total_search" src="resources/cust_in/search.png">
			</button>
			<input class="Text_box" id="custNum" onkeyup="custEvent(event);" onkeydown="custEnter(event);"
			value="${ changeDtIn.CUST_NM }">
			<!-- 고객번호조회 end -->
			<!-- 전체검색 -->
			<button type="button" id="Search_but" onclick="Search_but_TotalSerchs()">
				<img class="total_search" src="resources/cust_in/search.png">
			</button>
		</div>
		<br>
	</div>
</div>

<span id="title">고객기본정보</span>
<div id="sale-table">
	<!-- 고객명 -->
	<div class="custNameWrap">
		<span>*</span>
		<span class="textWrap">고객명</span>
		<input class="inputBox" id="custNameId2" name="CUST_NM" value="${ changeDtIn.CUST_NM }"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>>
	</div>
	<!-- 생년월일 -->
	<div class="custDateWrap">
		<span>*</span>
		<label class="textWrap">생년월일</label>
		<input type="date" class="inputBox" id="custDateBox" value="${changeDtIn.BRDY_DT}"
		<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>>
	</div>
	<!-- 성별 -->
	<div class="custNameWrapR">
		<span>*</span>
		<label class="textWrap">성별</label>
		<input type="radio" class="radio_check" id="custSexId" name="SEX_CD" value="F" 
			<c:if test="${changeDtIn.SEX_CD == 'F'}"> checked </c:if>>
		<span>여자</span>
		<input type="radio" class="radio_check" id="custSexIdM" name="SEX_CD" value="M"
			<c:if test="${changeDtIn.SEX_CD == 'M'}"> checked </c:if>>
		<span>남자</span>
	</div><br>
	<!--생일 양력/음력 -->
	<div class="custScalWrap">
		<span>*</span>
		<label class="textWrap">생일</label>
		<input type="radio" class="radio_check" id="custScalY" name="SCAL_YN" value="0"
		<c:if test="${changeDtIn.SCAL_YN == 0}"> checked </c:if>>
		<span>양력</span>
		<input type="radio" class="radio_check" id="custScalN" name="SCAL_YN" value="1"
		<c:if test="${changeDtIn.SCAL_YN == 1}"> checked </c:if>>
		<span>음력</span>
	</div>
	<!-- 결혼기념일 -->
	<div class="custNameWrap">
		<span style="color: white;">*</span>
		<label class="textWrap">결혼기념일</label>
		<input type="date" class="inputBox" id="custMarryBox" value="${changeDtIn.MRRG_DT}"
		<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>>
	</div>
	<!-- 직업코드 -->
	<div class="custNameWrapR">
		<span>*</span>
		<label class="textWrap">직업코드</label>
		<select class="inputBox" id="jobCode" name="POC_CD">
			<option value="" id="">선택해주세요</option>
			<option value="10" id="10"
			<c:if test="${changeDtIn.POC_CD == '10'}"> selected </c:if>>학생</option>
			<option value="20" id="20"
			<c:if test="${changeDtIn.POC_CD == '20'}"> selected </c:if>>회사원</option>
			<option value="30" id="30"
			<c:if test="${changeDtIn.POC_CD == '30'}"> selected </c:if>>공무원</option>
			<option value="40" id="40"
			<c:if test="${changeDtIn.POC_CD == '40'}"> selected </c:if>>전문직</option>
			<option value="50" id="50"
			<c:if test="${changeDtIn.POC_CD == '50'}"> selected </c:if>>군인</option>
			<option value="60" id="60"
			<c:if test="${changeDtIn.POC_CD == '60'}"> selected </c:if>>주부</option>
			<option value="90" id="90"
			<c:if test="${changeDtIn.POC_CD == '90'}"> selected </c:if>>연예인</option>
			<option value="99" id="99"
			<c:if test="${changeDtIn.POC_CD == '99'}"> selected </c:if>>기타</option>
		</select><br>
	</div><br>
	<!-- 휴대폰번호 -->
	<div class="custPhoneWrap">
	<span>*</span>
		<label class="textWrap">휴대폰번호</label>
		<input class="phoneinputBox" id="phone1" value="${changeDtIn.MBL_NO1}" style="margin-left: 38px; width: 54px;">
		<input class="phoneinputBox" id="phone2"value="${changeDtIn.MBL_NO2}" maxlength="4"
			oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>>
		<input class="phoneinputBox" id="phone3" name="phone39" value="${changeDtIn.MBL_NO3}" maxlength="4"
			oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>>
	<button type="button" id="phoneBut" onclick="phoneCheck();">변경</button><br>
	<span id="guide" style="font-size: 14px;margin-left: 140px;"></span>
	<input type="hidden" id="idDuplicateCheck" value="0">
	</div>
	
	<!-- 가입매장 -->
	<div class="custShopWrap" style="margin-left: 248px;">
		<span>*</span>
		<span class="textWrap">가입매장</span>
			<input class="loginInputBox" id="saleCode" name="JN_PRT_CD" value="${changeDtIn.JN_PRT_CD}" style="margin-left: 26px;" readonly>
		<button type="button" id="Search_but_sale" onclick="Search_but_search()">
			<img class="total_search" src="resources/cust_in/search.png">
		</button>
		<c:if test="${ loginUser.userDtCd == 2 }">
			<input class="loginInputBox" id="saleName" onkeyup="saleEvent(event);" onkeydown="enter(event);" value="${changeDtIn.PRT_NM}" name="joinName">
		</c:if>
		<c:if test="${ loginUser.userDtCd == 1 }">
			<input class="loginInputBox" id="saleName" onkeyup="saleEvent(event);" onkeydown="enter(event);" name="joinName" value="${changeDtIn.PRT_NM}" readonly>
		</c:if>
		<span></span>
	</div><br>
	<!--우편물수령주소 자택/직장 -->
	<div class="custAddressTextWrap">
		<span>*</span>
		<label class="textWrap">우편물수령주소</label>
		<input type="radio" class="radio_check" id="addressH" name="PSMT_GRC_CD" value="H"
			<c:if test="${changeDtIn.PSMT_GRC_CD == 'H'}"> checked </c:if>>
		<span>자택</span>
		<input type="radio" class="radio_check" id="addressO" name="PSMT_GRC_CD" value="O"
			<c:if test="${changeDtIn.PSMT_GRC_CD == 'O'}"> checked </c:if>>
		<span>직장</span>
	</div>
	<!-- 이메일 -->
	<div class="custEmailWrap">
		<span>*</span>
		<label class="textWrap">이메일</label>
		<input class="inputBox" id="custEmailId" value="${changeDtIn.EMAIL1}"
			oninput="this.value = this.value.replace(/[^0-9a-zA-Z-_\.]/g, '').replace(/(\..*)\./g, '$1');"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>><!-- 한글입력막기 -->
		@<input class="inputBox" id="custEmailIdDetails" value="${changeDtIn.EMAIL2}"
			oninput="this.value = this.value.replace(/[^0-9a-zA-Z-_\.]/g, '').replace(/(\..*)\./g, '$1');"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>><!-- 한글입력막기 -->
		<br>
	</div>
	<!--우편물수령주소 자택/직장 -->
	<div class="custAddressWrap">
		<input class="inputBox" style="background-color: #BDBDBD;" disabled>
		<input class="inputBox" id='firstAddress' name="ADDR" placeholder="직접입력" style="width: 250px;"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>
			value="${changeDtIn.ADDR}">
		<input class="inputBox" id='TwoAddress' name="ADDR_DTL" placeholder="직접입력"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>
			value="${changeDtIn.ADDR_DTL}">
		<br>
		<span id="addressSpan" style="font-size: 14px;margin-left: 137px;"></span>
	</div><br>
	<!-- 고객상태 -->
	<div class="custStateWrap">
		<span>*</span>
		<label class="textWrap">고객상태</label>
		<input type="radio" class="radio_check" id="custStateY" name="CUST_SS_CD" value="10"
			<c:if test="${changeDtIn.CUST_SS_CD == '10'}"> checked </c:if>>
		<label>정상</label>
		<input type="radio" class="radio_check" id="custStateN" name="CUST_SS_CD" value="80"
			<c:if test="${changeDtIn.CUST_SS_CD == '80'}"> checked </c:if>>
		<label>중지</label>
		<input type="radio" class="radio_check" id="outState" name="CUST_SS_CD" value="90"
			<c:if test="${changeDtIn.CUST_SS_CD == '90'}"> checked </c:if>>
		<label>해지</label>
	</div>
	<!-- 최초가입일자 -->
	<div class="firstJoinWrap">
		<label class="textWrap">최초가입일자</label>
		<input class="inputBox" id="fstJsDt" value="${ changeDtIn.FST_JS_DT }" style="background-color: #BDBDBD;" readonly>
	</div>
	<!-- 가입일자 -->
	<div class="joinWrap">
		<label class="textWrap">가입일자</label>
		<input class="inputBox" id="custJoinBox" value="${ changeDtIn.JS_DT }" style="background-color: #BDBDBD;" readonly>
	</div><br>
	<!-- 해지사유 -->
	<div class="custCauseWrap">
		<label class="textWrap">해지사유</label>
		<input class="inputBox" id="causeBox" name="CNCL_CNTS"
			<c:if test="${ loginUser.userDtCd == 1 }"> readonly </c:if>
		value="${ changeDtIn.CNCL_CNTS }">
	</div>
	<!-- 중지일자 -->
	<div class="stopWrap">
		<label class="textWrap">중지일자</label>
		<input class="inputBox" id="stopBox" value="${ changeDtIn.STP_DT }" style="background-color: #BDBDBD;" readonly>
	</div>
	<!-- 해지일자 -->
	<div class="exWrap">
		<label class="textWrap">해지일자</label>
		<input class="inputBox" id="cancelBox" value="${ changeDtIn.CNCL_DT }" style="background-color: #BDBDBD;" readonly>
	</div>
</div>
<!-- 고객기본정보end -->

<!-- 구매 -->
<span id="title">구매</span>
<div id="buy-table">
	<!-- 총구매금액 -->
	<div class="buyWrap" style="margin-left: 72px;">
		<span class="textWrap">총구매금액</span>
		<input class="inputBox" id="custNameId" value="${ changeDtIn.TOT_SAL_AMT }" style="background-color: #BDBDBD;text-align: right;" disabled>
	</div>
	<!-- 당월구매금액 -->
	<div class="buyWrap">
		<span class="textWrap">당월구매금액</span>
		<input class="inputBox" id="" value="${ changeDtIn.SAL_AMT }" style="margin-left: 20px; background-color: #BDBDBD;text-align: right;" disabled>
	</div>
	<!-- 최종구매일 -->
	<div class="buyWrap">
		<span class="textWrap">최종구매일</span>
		<input class="inputBox" id="" value="${ changeDtIn.SAL_DT }" style="margin-left: 34px; background-color: #BDBDBD;" disabled>
	</div>
</div>
<!-- 구매end -->

<!-- 포인트 -->
<span id="title">포인트</span>
<div id="buy-table">
	<!-- 총포인트 -->
	<div class="buyWrap" style="margin-left: 72px;">
		<span class="textWrap">총포인트</span>
		<input class="inputBox" id="" value="${ changeDtIn.TOT_PNT }" style="margin-left: 19px; background-color: #BDBDBD;text-align: right;" disabled>
	</div>
	<!-- 당월적립포인트 -->
	<div class="buyWrap">
		<span class="textWrap">당월적립포인트</span>
		<input class="inputBox" id="" value="${ changeDtIn.PNT }" style="background-color: #BDBDBD;text-align: right;" disabled>
	</div>
	<!-- 당월사용포인트 -->
	<div class="buyWrap">
		<span class="textWrap">당월사용포인트</span>
		<input class="inputBox" id="" value="${ changeDtIn.USE_PNT }" style="background-color: #BDBDBD;text-align: right;" disabled>
	</div>
</div>
<!-- 포인트end -->

<!-- 수신동의(통합) -->
<span id="title">수신동의(통합)</span>
<div id="buy-table">
	<!-- 이메일수신동의 -->
	<div class="buyWrap" style="margin-left: 72px;">
		<span>*</span>
		<span class="textWrap">이메일 수신동의</span>
		<input type="radio" class="radio_check" id="emailStateId" name="emailState" value="Y"
			<c:if test="${changeDtIn.EMAIL_RCV_YN == 'Y'}"> checked </c:if>>
		<label>예</label>
		<input type="radio" class="radio_check" id="emailStateId2" name="emailState" value="N"
			<c:if test="${changeDtIn.EMAIL_RCV_YN == 'N'}"> checked </c:if>>
		<label>아니오</label>
	</div>
	<!-- SMS수신동의 -->
	<div class="buyWrap">
		<span>*</span>
		<span class="textWrap">SMS수신동의</span>
		<input type="radio" class="radio_check" id="SNSStateId" name="SNSState" value="Y"
			<c:if test="${changeDtIn.SMS_RCV_YN == 'Y'}"> checked </c:if>>
		<label>예</label>
		<input type="radio" class="radio_check" id="SNSStateIdN" name="SNSState" value="N"
			<c:if test="${changeDtIn.SMS_RCV_YN == 'N'}"> checked </c:if>>
		<label>아니오</label>
	</div>
	<!-- DM수신동의 -->
	<div class="buyWrap">
		<span>*</span>
		<span class="textWrap">DM수신동의</span>
		<input type="radio" class="radio_check" id="DMStateId" name="DMState" value="Y"
			<c:if test="${changeDtIn.DM_RCV_YN == 'Y'}"> checked </c:if>>
		<label>예</label>
		<input type="radio" class="radio_check" id="DMStateIdN" name="DMState" value="N"
			<c:if test="${changeDtIn.DM_RCV_YN == 'N'}"> checked </c:if>>
		<label>아니오</label>
	</div>
</div>
<!-- 수신동의end -->
<button type="button" class="popupBut" id="close" onclick="location.href='managerPage.me'">
닫기
</button>
<c:if test="${ loginUser.userDtCd == 2 }">
	<button type="button" class="popupBut" id="updateBtn">
	저장
	</button>
</c:if>
</form>

<script type="text/javascript">
var aftNo = $('#CNo').val();
$('#aftNo').val(aftNo);

//오늘날짜
const offset = new Date().getTimezoneOffset() * 60000;
var todaybe = new Date(Date.now() -offset).toISOString().substring(0, 10);
//하이픈 제거
var today = todaybe.replace(/\-/g,'');
console.log(today);

//고객상태
var checkValue = $('input[name="CUST_SS_CD"]:checked').val();
console.log(checkValue);
var CssCd = $('#CssCd').val();//원본값
console.log(CssCd);

//정상
if(checkValue == 10){
	$('#outState').prop('disabled', true);//해지버튼 막기
	$('#causeBox').prop('disabled', true);//사유내용 막기
}
//중지
if(checkValue == 80){
	$('#causeBox').prop('disabled', true);
}
//해지
if(checkValue == 90){
	$('#custStateY').prop('disabled', false);
	$('#custStateN').prop('disabled', true);
	$('#causeBox').prop('disabled', false);

	$('#cancelBox').val(today);//원본값
}
if(checkValue == ''){
	$('#outState').prop('disabled', false);
}

//정상버튼 클릭시
$("#custStateY").change(function(){
	debugger;
	$('#causeBox').val('');
	$('#causeBox').prop('disabled', true);
	var checkVal = $('input[name="CUST_SS_CD"]:checked').val();
	var mb1 = $('#mb1').val();
	var mb2 = $('#mb2').val();
	var mb3 = $('#mb3').val();
	var CNm = $('#CNm').val();
	
	console.log(checkVal);
	console.log(CssCd);
	//해지->정상
	if(checkVal == 10 && CssCd == 90){
		alert("고객명과 휴대폰번호를 입력해주세요.")
		$('#custNameId2').val('');
		$('#phone1').val('');
		$('#phone2').val('');
		$('#phone3').val('');
		
		$('#cancelBox').val('');
		
	}
// 	//정상
// 	if(checkVal == 10){
// 		$('#custNameId2').val('');
// 	}
});

//중지버튼 클릭시
$("#custStateN").change(function(){
	$('#causeBox').val('');
	$('#causeBox').prop('disabled', false);
	var checkVal = $('input[name="CUST_SS_CD"]:checked').val();
	var mb1 = $('#mb1').val();
	var mb2 = $('#mb2').val();
	var mb3 = $('#mb3').val();
	var CNm = $('#CNm').val();
	console.log();
	console.log(mb2);
	
	//중지->해지
	if(checkVal == 80){
		$('#custNameId2').val(CNm);
		$('#causeBox').val('');
		$('#causeBox').prop('disabled', true);
	}
});

//해지버튼 클릭시
$("#outState").change(function(){
	$('#causeBox').val('');
	$('#causeBox').prop('disabled', false);
	var checkVal = $('input[name="CUST_SS_CD"]:checked').val();
});

//날짜 체크 윤달
var previousDate = document.querySelector("#previousDate")

function date (value){
	var result = true;
	try {
	    var date = value.split("-");
	    var y = parseInt(date[0], 10),
	        m = parseInt(date[1], 10),
	        d = parseInt(date[2], 10);
	    
	    var dateRegex = /^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/;
	    result = dateRegex.test(d+'-'+m+'-'+y);
	} catch (err) {
		result = false;
	}    
  return result;
};

//휴대폰번호 중복, 중복확인했는지
var phoneCheck2 = false;
var phoneCheck3 = false;

$('#phone2').on('change paste keyup', function(){
	  phoneCheck2 = false; 
});

$('#phone3').on('change paste keyup', function(){
	  phoneCheck3 = false; 
});
 

//핸드폰 중복체크
function phoneCheck() {
	debugger;
	var phone1 = $("#phone1").val();
	var phone2 = $("#phone2").val();
	var phone3 = $("#phone3").val();
	var phoneNum = phone1 + phone2 + phone3

	//휴대폰번호 길이 유효성 체크
	if (phone1.trim() == '' || phone1.trim().length != 3) {
		alert('휴대폰 번호를 확인해주세요.');
		$("#phone1").focus();
	}else if (phone2.trim() == ''|| phone2.trim().length < 3) {
		alert('휴대폰 번호를 확인해주세요.');
		$("#phone2").focus();
	} else if (phone3.trim() == '' || phone3.trim().length != 4) {
		alert('휴대폰 번호를 확인해주세요.');
		$("#phone3").focus();
	} else if(phone2.trim() == '000' || phone2.trim() == '0000'){
		alert('유효하지 않은 번호입니다.');
		return false;
	} else if(phone3.trim() == '000' || phone3.trim() == '0000'){
		alert('유효하지 않은 번호입니다.');
		phone3.focus();
		return false;
	} else {
		console.log('2');
		$.ajax({
			url : 'phoneNum.me',
			type : "post",
			data : {"phoneNum" : phoneNum},
			success : function(data) {
				console.log(data);
				if (data == '1') {
					alert("사용 중인 핸드폰 번호입니다.");
					$('#phone1').val($('#mb1').val());
					$('#phone2').val($('#mb2').val());
					$('#phone3').val($('#mb3').val());
					console.log($('#phone1').val());
					$('#idDuplicateCheck').val(0);
					Check2 = false;
					phoneCheck3 = false;
				} else {
					alert("사용 가능한 핸드폰 번호입니다.");
					$('#idDuplicateCheck').val(1);
					phoneCheck2 = true;
					phoneCheck3 = true;
					console.log('4');
				}
			},
			error : function(data) {
				console.log(data);
			}
		});
	};
};

//주소 1칸 입력시 2칸도 입력필수
function Address() {
	var firstAddress = $("#firstAddress").val();
	var TwoAddress = $("#TwoAddress").val();
	
	if (firstAddress.trim() !== '' && TwoAddress.trim() == '') {
		var area = document.getElementById('addressSpan');
		alert("상세주소도 입력해주세요.");
		return false;
	} else if (firstAddress.trim() == '' && TwoAddress.trim() !== '') {
		var area = document.getElementById('addressSpan');
		alert("시/구/동 주소도 입력해주세요.");
		return false;
	}
}

////////////////////////////////-고객정보전체 조회-////////////////////////////////////////

//고객번호 인풋창에 값이 있을 시 실행
// var custInput = '';
// $(document).ready(function() {
// 	debugger;
// 	custInput = $('#cc').val();
// 	console.log(custInput);
// 	$('#custInput').val(custInput);
// 	console.log(custInput);
// 	if(custInput == "" || custInput == null){
// 		console.log('값이 비어있음');
// 	}else{
// 		console.log('값이 있음');
// 	}

// 	//**원본생년월일**
// 	var custBirthdayBox = $('#CDateOrigin').val();
// 	var brdyDt = custBirthdayBox.replace(/\-/g,'');
// 	document.getElementById("CDate1").value = brdyDt;
	
// 	//**원본결혼기념일**
// 	var custMarryBox = $('#CMarryOrigin').val();
// 	var brdyDt = custMarryBox.replace(/\-/g,'');
// 	document.getElementById("CMarry").value = brdyDt;
	
// 	//**원본 중지일자**
// 	var stopDt1_BE = $('#stopDt').val();
// 	var stopDt1 = stopDt1_BE.replace(/\-/g,'');
// 	document.getElementById("stopDt").value = stopDt1;
	
// 	//**원본 해지일자**
// 	var cancelBox_BE = $('#cancelBox').val();
// 	var cancelBox = cancelBox_BE.replace(/\-/g,'');
// 	document.getElementById("cancelDt").value = cancelBox;
// });


//고객정보전체 조회
function Search_but_TotalSerchs(){

	debugger;
	//재검색시 변경전후 내용 비교
	ReSearch();
	var ReSearchResult = $('#result').val();
	console.log(ReSearchResult);
	
	if(ReSearchResult == "true" || ReSearchResult == ""){//변경내용없이 넘어올때 "" 빈값으로 넘어온다, 변경된 내용이 있을때 "확인"누를 시 true반환
														//변경된 내용 "취소"누를 시 false 반환 
	var custInput = $('#custInput').val();				//고객번호
	var custNum = $('#custNum').val();
	console.log(custInput);
	//2글자 이상 입력하시오.
	if(custNum == '') {
		alert('고객조회 후 검색해주세요.');
		$('#custNum').focus();
		return false;
	}
	
	$.ajax({//고객정보전체 조회
		url: 'custTotal.me',
		data: {'custInput':custInput},
		type: 'post',
		dataType: 'json',
		success: function(data){
			console.log(data);
			console.log(data.custTotal.CUST_NM);
			//**원본고객번호
			$('#CNo').val(data.custTotal.CUST_NO);
			//고객번호
			$('#aftNo').val(data.custTotal.CUST_NO);
			//고객명
			$('#custNum').val(data.custTotal.CUST_NM);
			$('#custNameId2').val(data.custTotal.CUST_NM);
			console.log(data.custTotal.SEX_CD);
			//**원본 고객명**
			$('#CNm').val(data.custTotal.CUST_NM);
			
			//생년월일
			$('#custDateBox').val(data.custTotal.BRDY_DT);
			//생년월일 하이픈 제거
			var custBirthdayBox = $('#custDateBox').val();
			var brdyDt = custBirthdayBox.replace(/\-/g,'');
			document.getElementById("birth").value = brdyDt;
			
			//**원본생년월일**
			$('#CDate').val(data.custTotal.BRDY_DT);
			//**원본 생년월일 하이픈 제거**
			var custBirthdayBox = $('#CDate').val();
			var brdyDt = custBirthdayBox.replace(/\-/g,'');
			document.getElementById("CDate1").value = brdyDt;
			
			//결혼기념일
			$('#custMarryBox').val(data.custTotal.MRRG_DT);
			
			//통결혼기념일
			//결혼기념일 하이픈 제거
			var custMarryBox2 = $('#custMarryBox').val();
			var mrrgDt = custMarryBox2.replace(/\-/g,'');
			document.getElementById("MarryDay").value = mrrgDt;
			
			//**원본결혼기념일**
			$('#CMarryOrigin').val(data.custTotal.MRRG_DT);
			var custBirthdayBox = $('#CMarryOrigin').val();
			var brdyDt = custBirthdayBox.replace(/\-/g,'');
			document.getElementById("CMarry").value = brdyDt;
			
			//핸드폰번호
			$('#phone1').val(data.custTotal.MBL_NO1);
			$('#phone2').val(data.custTotal.MBL_NO2);
			$('#phone3').val(data.custTotal.MBL_NO3);
			
			//통핸드폰번호
			var phone1 = $('#phone1').val();	//핸드폰번호1
			var phone2 = $('#phone2').val();	//핸드폰번호2
			var phone3 = $('#phone3').val();	//핸드폰번호3
			var phoneFull = phone1+phone2+phone3;

			//통핸드폰번호
			document.getElementById("phoneNumble").value = phoneFull;
			
			//**원본핸드폰번호**
			var mb1 = $('#mb1').val(data.custTotal.MBL_NO1);
			var mb2 = $('#mb2').val(data.custTotal.MBL_NO2);
			var mb3 = $('#mb3').val(data.custTotal.MBL_NO3);
			//**원본통 핸드폰번호
			document.getElementById("mb_f").value = mb1+mb2+mb3
			
			//가입매장코드
			$('#saleCode').val(data.custTotal.JN_PRT_CD);
			//**원본가입매장코드**
			$('#Ccd').val(data.custTotal.JN_PRT_CD);
			//가입매장명
			$('#saleName').val(data.custTotal.PRT_NM);
			
			//**원본핸드폰**
			$('#mb_f').val(data.custTotal.MBL_NO);
			
			//이메일
			$('#custEmailId').val(data.custTotal.EMAIL1);
			//**원본이메일**
			$('#Cemail1').val(data.custTotal.EMAIL1);
			//**원본통이메일**
			$('#CSemail').val(data.custTotal.EMAIL);
			
			//이메일주소
			$('#custEmailIdDetails').val(data.custTotal.EMAIL2);
			//**원본이메일주소**
			$('#Cemail2').val(data.custTotal.EMAIL2);
			
			//이메일 @붙히기
			var custEmailId = $('#custEmailId').val();					//이메일아이디
			var custEmailIdDetails = $('#custEmailIdDetails').val();	//이메일주소
			
			//이메일값이 없을 경우 @만 들어갈 수 있기 때문에 이메일아이디와 이메일주소가 있을 시에만 넣어준다. 
			if(custEmailId != ''&& custEmailIdDetails != ''){
				var email = custEmailId+'@'+custEmailIdDetails;
				//이메일
				document.getElementById("emailFull").value = email;
			}
			
			
			//해지사유
			$('#causeBox').val(data.custTotal.CNCL_CNTS);
			//**원본해지사유**
			$('#Ccause').val(data.custTotal.CNCL_CNTS);
			//주소
			$('#firstAddress').val(data.custTotal.ADDR);
			//**원본주소**
			$('#Cadd').val(data.custTotal.ADDR);
			//상세주소
			$('#TwoAddress').val(data.custTotal.ADDR_DTL);
			//**원본상세주소**
			$('#CaddDt').val(data.custTotal.ADDR_DTL);
			//성별
			if(data.custTotal.SEX_CD == 'F'){
				console.log('f임')//성별 값에 따라 체크박스 체크 또는 해제
				$('#custSexIdM').prop('checked', false);
				$('#custSexId').prop('checked', true);
				//**원본성별**
				$('#CSexId').val(data.custTotal.SEX_CD);
			} else{
				console.log('m임')
				$('#custSexId').prop('checked', false);
				$('#custSexIdM').prop('checked', true);
				//**원본성별**
				$('#CSexId').val(data.custTotal.SEX_CD);
			}
			//생일
			if(data.custTotal.SCAL_YN == '0'){
				console.log('0임')//생일
				$('#custScalN').prop('checked', false);
				$('#custScalY').prop('checked', true);
				//**원본생일**
				$('#CScal').val(data.custTotal.SCAL_YN);
			} else{
				console.log('1임')
				$('#custScalY').prop('checked', false);
				$('#custScalN').prop('checked', true);
				//**원본생일**
				$('#CScal').val(data.custTotal.SCAL_YN);
			}
			//직업코드
			if(data.custTotal.POC_CD == '10'){
				console.log('10임')
				$('#10').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			} else if(data.custTotal.POC_CD == '20'){
				console.log('20임')
				$('#20').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			} else if(data.custTotal.POC_CD == '30'){
				console.log('30임')
				$('#30').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			} else if(data.custTotal.POC_CD == '40'){
				console.log('40임')
				$('#40').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			} else if(data.custTotal.POC_CD == '50'){
				console.log('50임')
				$('#50').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			} else if(data.custTotal.POC_CD == '60'){
				console.log('60임')
				$('#60').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			} else if(data.custTotal.POC_CD == '90'){
				console.log('90임')
				$('#90').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			} else{
				$('#99').prop('selected', true);
				//**원본 직업코드**
				$('#CPoc').val(data.custTotal.POC_CD);
			}
			//우편물수령주소 자택/직장
			if(data.custTotal.PSMT_GRC_CD == 'H'){
				console.log('자택임')//성별 값에 따라 체크박스 체크 또는 해제
				$('#addressO').prop('checked', false);
				$('#addressH').prop('checked', true);
				//**원본 우편물수령주소 자택/직장**
				$('#CPsmt').val(data.custTotal.PSMT_GRC_CD);
			} else{
				console.log('직장임')
				$('#addressH').prop('checked', false);
				$('#addressO').prop('checked', true);
				//**원본 우편물수령주소 자택/직장**
				$('#CPsmt').val(data.custTotal.PSMT_GRC_CD);
			}
			//고객상태
			if(data.custTotal.CUST_SS_CD == '10'){
				console.log('정상임')//상태 값에 따라 체크박스 체크 또는 해제
				$('#custStateN').prop('checked', false);
				$('#outState').prop('checked', false);
				$('#custStateY').prop('checked', true);
				//**원본 고객상태**
				$('#CssCd').val(data.custTotal.CUST_SS_CD);
			} else if(data.custTotal.CUST_SS_CD == '80'){
				console.log('중지임')
				$('#custStateY').prop('checked', false);
				$('#outState').prop('checked', false);
				$('#custStateN').prop('checked', true);
				//**원본 고객상태**
				$('#CssCd').val(data.custTotal.CUST_SS_CD);
			} else{
				console.log('해지임')
				$('#custStateY').prop('checked', false);
				$('#custStateN').prop('checked', false);
				$('#outState').prop('checked', true);
				//**원본 고객상태**
				$('#CssCd').val(data.custTotal.CUST_SS_CD);
			}
			
			//최초가입일자
			$('#fstJsDt').val(data.custTotal.FST_JS_DT);
			//가입일자
			$('#custJoinBox').val(data.custTotal.JS_DT);
			
			//**원본생년월일**
			$('#CDate').val(data.custTotal.BRDY_DT);
			//**원본 생년월일 하이픈 제거**
			var custBirthdayBox = $('#CDate').val();
			var brdyDt = custBirthdayBox.replace(/\-/g,'');
			document.getElementById("CDate1").value = brdyDt;
			
			//이메일수신동의
			if(data.custTotal.EMAIL_RCV_YN == 'Y'){
				console.log('이메일동의임')//성별 값에 따라 체크박스 체크 또는 해제
				$('#emailStateId2').prop('checked', false);
				$('#emailStateId').prop('checked', true);
				//**원본 이메일수신동의**
				$('#Cemail').val(data.custTotal.EMAIL_RCV_YN);
			} else{
				console.log('이메일비동의임')
				$('#emailStateId').prop('checked', false);
				$('#emailStateId2').prop('checked', true);
				//**원본 이메일수신동의**
				$('#Cemail').val(data.custTotal.EMAIL_RCV_YN);
			}
			
			//SMS수신동의
			if(data.custTotal.SMS_RCV_YN == 'Y'){
				console.log('SMS동의임')//성별 값에 따라 체크박스 체크 또는 해제
				$('#SNSStateIdN').prop('checked', false);
				$('#SNSStateId').prop('checked', true);
				//**원본 SMS수신동의**
				$('#Csms').val(data.custTotal.SMS_RCV_YN);
			} else{
				console.log('SMS비동의임')
				$('#SNSStateId').prop('checked', false);
				$('#SNSStateIdN').prop('checked', true);
				//**원본 SMS수신동의**
				$('#Csms').val(data.custTotal.SMS_RCV_YN);
			}
			
			//DM수신동의
			if(data.custTotal.DM_RCV_YN == 'Y'){
				console.log('DM동의임')//성별 값에 따라 체크박스 체크 또는 해제
				$('#DMStateIdN').prop('checked', false);
				$('#DMStateId').prop('checked', true);
				//**원본 DM수신동의**
				$('#CDm').val(data.custTotal.DM_RCV_YN);
			} else{
				console.log('DM비동의임')
				$('#DMStateId').prop('checked', false);
				$('#DMStateIdN').prop('checked', true);
				//**원본 DM수신동의**
				$('#CDm').val(data.custTotal.DM_RCV_YN);
			}
			
		},
		error: function(data){
			console.log(data);
			alert('조회할 수 없습니다.');
		}
	});
	}
};

////////////////////////////////-고객정보전체 조회end-////////////////////////////////////////

//휴대폰번호 연결
var phone1 = $("#phone1").val();
var phone2 = $("#phone2").val();
var phone3 = $("#phone3").val();
var mblNo = phone1 + phone2 + phone3
document.getElementById('phoneNumble').value = mblNo;

//생년월일 하이픈 제거
var custBirthdayBox = $('#custDateBox').val();
var brdyDt = custBirthdayBox.replace(/\-/g,'');
document.getElementById("birth").value = brdyDt;

//**원본생년월일 하이픈 제거
var custBirthdayBox = $('#custDateBox').val();
var brdyDt = custBirthdayBox.replace(/\-/g,'');
document.getElementById("birth").value = brdyDt;

//결혼기념일 하이픈 제거
var custMarryBox2 = $('#custMarryBox').val();
var mrrgDt = custMarryBox2.replace(/\-/g,'');
document.getElementById("MarryDay").value = mrrgDt;

//중지일자 하이픈 제거
var stopBox = $('#stopBox').val();
var stopDt = stopBox.replace(/\-/g,'');
document.getElementById("stopDt2").value = stopDt;

//해지일자 하이픈 제거
var cancelBox = $('#cancelBox').val();
var cancelDt = cancelBox.replace(/\-/g,'');
document.getElementById("cancelDt2").value = cancelDt;

//이메일 @붙히기
var custEmailId = document.getElementById('custEmailId').value;					//이메일아이디
var custEmailIdDetails = document.getElementById('custEmailIdDetails').value;	//이메일주소

//이메일값이 없을 경우 @만 들어갈 수 있기 때문에 이메일아이디와 이메일주소가 있을 시에만 넣어준다. 
if(custEmailId != ''&& custEmailIdDetails != ''){
	var email = custEmailId+'@'+custEmailIdDetails;
	//이메일
	document.getElementById("emailFull").value = email;
}

//휴대폰번호 중복, 중복확인했는지
var phoneCheck2 = false;
var phoneCheck3 = false;

$('#phone2').on('change paste keyup', function(){
	  phoneCheck2 = false; 
});

$('#phone3').on('change paste keyup', function(){
	  phoneCheck3 = false; 
});

/////////////////////////////////저장버튼 클릭시///////////////////////

$('#updateBtn').on('click', function(){
	
	debugger;
// 	ReSearch();
// 	changCheckV();

	//오늘날짜
	const offset = new Date().getTimezoneOffset() * 60000;
	var todaybe = new Date(Date.now() -offset).toISOString().substring(0, 10);
	//하이픈 제거
	var today = todaybe.replace(/\-/g,'');
	console.log(today);
	
	var CssCd = $('#CssCd').val();
	var checkValue = $('input[name="CUST_SS_CD"]:checked').val();
	console.log(CssCd);
	console.log(checkValue);
	
	var custNameId2 = $('#custNameId2').val();
	var phone1 = $('#phone1').val();
	var phone2 = $('#phone2').val();
	var phone3 = $('#phone3').val();
	var fullphone = phone1+phone2+phone3;
	console.log(fullphone);
	
	var mb_f = $('#mb_f').val();
	console.log(mb_f);
	
	if(custNameId2 == '' || custNameId2.length == 0){
		alert('고객명을 입력해주세요.')
		return false;
	}
	if(phone1 == ''){
		alert('휴대폰번호를 입력해주세요.')
		return false;
	} else if(phone2 == ''){
		alert('휴대폰번호를 입력해주세요.')
		return false;
	} else if(phone3 == ''){
		alert('휴대폰번호를 입력해주세요.')
		return false;
	} else if(phoneCheck2 && phoneCheck3){//ajax 핸드폰번호 중복확인요청
		console.log('1');
	} else if(mb_f != fullphone){
		alert('휴대폰번호 중복확인을 해주세요');
        return false;
	}
	
	//주소 1칸 입력시 2칸도 입력필수
	Address();
	
	//통핸드폰번호
	var phone1 = $('#phone1').val();	//핸드폰번호1
	var phone2 = $('#phone2').val();	//핸드폰번호2
	var phone3 = $('#phone3').val();	//핸드폰번호3
	var phoneFull = phone1+phone2+phone3;

	//통핸드폰번호
	document.getElementById("phoneNumble").value = phoneFull;
	
	//통이메일
	var custEmailId = $('#custEmailId').val();	//이메일
	var custEmailIdDetails = $('#custEmailIdDetails').val();	//이메일주소
	var emailFull = custEmailId+'@'+custEmailIdDetails;	
	
	document.getElementById("emailFull").value = emailFull;
// 	var changCheckVal = $('#changCheckVal').val();
// 	if(changCheckVal != false){
	
	//해지버튼 값 전달
	//->해지
	if(checkValue == 90){
		$('#custNameId2').val('해지고객');
		$('#phone1').val('000');
		$('#phone2').val('0000');
		$('#phone3').val('0000');
		$('#phoneNumble').val('00000000000');
		
		//해지일자 값 넣기
		$('#cancelBox').val(today);
	}
	//->중지
	if(checkValue == 80){
		//중지일자 값 넣기
		$('#stopBox').val(today);
		//히든으로 숨겨져있는 변경확인용 중지일자 값 넣기
		$('#stopDt2').val(today);
	}
	//정상
	if(checkValue == 10){
		$('#causeBox').val('');//해지사유
		$('#cancelBox').val('');//해지일자
		
		//정상으로 돌아올 시 가입날짜 변경
		$('#custJoinBox').val(today);
		//히든으로 숨겨져있는 변경확인용 가입날짜
		$('#jsDt2').val(today);
		
	}
	//해지->정상
	if(checkValue == 10 && CssCd == 90){
		$('#causeBox').val('');//해지사유
		$('#cancelBox').val('');//해지일자
	}
	
	//등록버튼 안에 등록버튼 누를 시
	if(confirm("고객정보를 수정하시겠습니까?")){
		debugger;
		//해지->정상
		if(checkValue == 10 && CssCd == 90){
			$('#causeBox').val('');//해지사유
			$('#cancelBox').val('');//해지일자
		}
			
		//히스토리
		debugger;
		//변경값(변경후 값 확인)
		var custNameId2 = $('#custNameId2').val();
		var custDateBox = $('#custDateBox').val();
		var custMarryBox = $('#custMarryBox').val();
		var custSex = $('input[name=SEX_CD]:checked').val();
		var custScal = $('input[name=SCAL_YN]:checked').val();
		var jobCode = $('#jobCode').val();
		var causeBox = $('#causeBox').val();
		var custState = $('input[name=CUST_SS_CD]:checked').val();
		var emailState = $('input[name=emailState]:checked').val();
		var SMSState = $('input[name=SNSState]:checked').val();
		var DMState = $('input[name=DMState]:checked').val();
		var firstAddress = $('#firstAddress').val();
		var TwoAddress = $('#TwoAddress').val();
		var custAddress = $('input[name=PSMT_GRC_CD]:checked').val();
		var cancelBox = $('#cancelBox').val();
		
		//핸드폰번호 변경
		var phone1 = $('#phone1').val();
		var phone2 = $('#phone2').val();
		var phone3 = $('#phone3').val();
				
		var saleCode = $('#saleCode').val();
		//이메일
		var custEmailId = $('#custEmailId').val();
		var custEmailIdDetails = $('#custEmailIdDetails').val();
				
		var custCh = $('#custChange').serializeArray();//변경전 내용
		var custUpdate = $('#custUpdateId').serializeArray();//변경 후 내용
		console.log(custCh);
		console.log(custUpdate);
		var c = -1;
		for(var i = 0; i < custUpdate.length; i++){//변경한 내용 name이 더 많아서
			var custUpdate_name = custUpdate[i].name;
			var custUpdate_value = custUpdate[i].value;
			for(var e = 0; e < custCh.length; e++){//변경전 내용
				var custCh_name = custCh[e].name;
				var custCh_value = custCh[e].value;
				
				if(custCh_name == custUpdate_name && custCh_value != custUpdate_value){
					var BemapObject = new Map();
					console.log("custCh_name:"+custCh_name);//DMState
					console.log("custCh_value:"+custCh_value);//N
							
					console.log("custUpdate_name:"+custUpdate_name);//DMState
					console.log("custUpdate_value:"+custUpdate_value);//Y
							
					c++;
					arr[c] = {
							'FST_USER_ID':custCh[0].value,
							'CUST_NO':custCh[1].value,
							'CHG_BF_CNT':custCh_value,
							'CHG_CD':custUpdate_name,
							'CHG_AFT_CNT':custUpdate_value,
							'CUST_NO':$('#aftNo').val(),
							'MBL_NO':$('#phoneNumble').val(),
							'BRDY_DT':$('#birth').val(),
							'MRRG_DT':$('#MarryDay').val(),
							'STP_DT':$('#stopDt2').val(),
							'CNCL_DT':$('#cancelDt2').val(),
							'CNCL_CNTS':$('#causeBox').val(),
							'LST_UPD_ID':$('#useridS').val(),
							'EMAIL':$('#emailFull').val(),
							'CUST_NM':$('#custNameId2').val(),
							'JS_DT':$('#jsDt2').val(),
							'SEX_CD':$('input[name="SEX_CD"]:checked').val(),
							'SCAL_YN':$('input[name="SCAL_YN"]:checked').val(),
							'POC_CD':$('#jobCode').val(),
							'JN_PRT_CD':$('#saleCode').val(),
							'PSMT_GRC_CD':$('input[name="PSMT_GRC_CD"]:checked').val(),
							'ADDR':$('#firstAddress').val(),
							'ADDR_DTL':$('#TwoAddress').val(),
							'CUST_SS_CD':$('input[name="CUST_SS_CD"]:checked').val(),
							'emailState':$('input[name="emailState"]:checked').val(),
							'SNSState':$('input[name="SNSState"]:checked').val(),
							'DMState':$('input[name="DMState"]:checked').val()
					};
				}
			}
		}
		console.log(arr);
				
		$.ajax({
			url : 'ChangeHistory.me',
			type : 'post',
			data : JSON.stringify(arr),
			dataType: 'json',
			contentType: "application/json",
			success: function(data){
				console.log(data);
				window.location.reload();
			},
			error: function(data) {
				console.log(data);
			}
		});
		
	}else{
		return false;
	}
});

//재검색시 변경전후 내용 비교
var arr = new Array();
var result = "";
function ReSearch(){
	//변경전후 내용 비교
	var custCh = $('#custChange').serializeArray();//변경전 내용
	var custUpdate = $('#custUpdateId').serializeArray();//변경 후 내용
	console.log(custCh);
	console.log(custUpdate);
	var c = -1;
	for(var i = 0; i < custUpdate.length; i++){//변경한 내용 name이 더 많아서
		var custUpdate_name = custUpdate[i].name;
		var custUpdate_value = custUpdate[i].value;
		for(var e = 0; e < custCh.length; e++){//변경전 내용
			var custCh_name = custCh[e].name;
			var custCh_value = custCh[e].value;
			
			if(custCh_name == custUpdate_name && custCh_value != custUpdate_value){
				var BemapObject = new Map();
				console.log("custCh_name:"+custCh_name);//DMState
				console.log("custCh_value:"+custCh_value);//N
				
				console.log("custUpdate_name:"+custUpdate_name);//DMState
				console.log("custUpdate_value:"+custUpdate_value);//Y
				
				c++;
				arr[c] = {
						'FST_USER_ID':custCh[0].value,
						'CUST_NO':custCh[1].value,
						'CHG_BF_CNT':custCh_value,
						'CHG_CD':custUpdate_name,
						'CHG_AFT_CNT':custUpdate_value
				};
			}
		}
	}
	debugger;
	console.log(arr);
	if(arr.length != 0 || arr != ''){
		var result = confirm("저장하지않은 내역이 존재합니다. 재검색 하시겠습니까?");
		document.getElementById('result').value = result;	
	}
};

//변경된 값이 없을 시 저장진행X
//변경전후 내용 비교
function changCheckV(){
var custCh = $('#custChange').serializeArray();//변경전 내용
var custUpdate = $('#custUpdateId').serializeArray();//변경 후 내용
console.log(custCh);
console.log(custUpdate);
	var c = -1;
	for(var i = 0; i < custUpdate.length; i++){//변경한 내용 name이 더 많아서
		var custUpdate_name = custUpdate[i].name;
		var custUpdate_value = custUpdate[i].value;
		for(var e = 0; e < custCh.length; e++){//변경전 내용
			var custCh_name = custCh[e].name;
			var custCh_value = custCh[e].value;
			
			if(custCh_name == custUpdate_name && custCh_value != custUpdate_value){
				var BemapObject = new Map();
				console.log("custCh_name:"+custCh_name);//변경전 이름
				console.log("custCh_value:"+custCh_value);//변경전 밸류
				
				console.log("custUpdate_name:"+custUpdate_name);//변경후 이름
				console.log("custUpdate_value:"+custUpdate_value);//변경후 밸류
				
				c++;
				arr[c] = {
						'FST_USER_ID':custCh[0].value,
						'CUST_NO':custCh[1].value,
						'CHG_BF_CNT':custCh_value,
						'CHG_CD':custUpdate_name,
						'CHG_AFT_CNT':custUpdate_value
				};
			}
		}
	}
	console.log(arr);
	if(arr.length == 0 || arr == ''){
		document.getElementById('changCheckVal').value = false;
		console.log(document.getElementById('changCheckVal').value);
	}
};
</script>
</body>
</html>